
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Random Thoughts">
      
      
      
        <link rel="canonical" href="https://AXGKl.github.io/blog/programming/python/prompt_toolkit/dup2/">
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.9">
    
    
      
        <title>Stream Control - AXGK Blog</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.120efc48.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.9647289d.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../lcd/lp/css/xterm.min.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="black" data-md-color-accent="deep-purple">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pythons-dup2-method-intercepting-stdin" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="AXGK Blog" class="md-header__button md-logo" aria-label="AXGK Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AXGK Blog
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Stream Control
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/AXGKl/blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    AXGKl/blog
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Overview
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../ll/apps/apps/" class="md-tabs__link">
        üêß LINUX
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../cloud/dnsmasq/" class="md-tabs__link">
        üí≠ CLOUD
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../rx/" class="md-tabs__link md-tabs__link--active">
        üíª DEV
      </a>
    </li>
  

  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../inet/videos/" class="md-tabs__link">
      üì∫ VIDS
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../logbook/" class="md-tabs__link">
      ‚úèÔ∏è  LOG
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../about/changelog/" class="md-tabs__link">
        About
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="AXGK Blog" class="md-nav__button md-logo" aria-label="AXGK Blog" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    AXGK Blog
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/AXGKl/blog" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    AXGKl/blog
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" data-md-state="indeterminate" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          üêß LINUX
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="üêß LINUX" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          üêß LINUX
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/apps/apps/" class="md-nav__link">
        Apps
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/devices/tv_q8/" class="md-nav__link">
        Devices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/distro/" class="md-nav__link">
        Distros
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/arco/" class="md-nav__link">
        Distros
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/emacs/emacs/" class="md-nav__link">
        Emacs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/gimp/gimp/" class="md-nav__link">
        Gimp
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" data-md-state="indeterminate" type="checkbox" id="__nav_2_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_7">
          Hardware
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hardware" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_7">
          <span class="md-nav__icon md-icon"></span>
          Hardware
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7_1" data-md-state="indeterminate" type="checkbox" id="__nav_2_7_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_7_1">
          Input
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Input" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_7_1">
          <span class="md-nav__icon md-icon"></span>
          Input
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/hw/input/keyboard/" class="md-nav__link">
        Keyboard
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/hw/input/k860/" class="md-nav__link">
        K860
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/hw/input/corne/" class="md-nav__link">
        Corne
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/hw/input/hp/" class="md-nav__link">
        HP
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/mkdocs/mkdocs/" class="md-nav__link">
        MkDocs
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9" data-md-state="indeterminate" type="checkbox" id="__nav_2_9" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_9">
          Suckless
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Suckless" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_9">
          <span class="md-nav__icon md-icon"></span>
          Suckless
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/sl/about/" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/sl/dwm/" class="md-nav__link">
        dwm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/sl/st/" class="md-nav__link">
        st
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9_4" data-md-state="indeterminate" type="checkbox" id="__nav_2_9_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_9_4">
          Statusbar Fun
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Statusbar Fun" data-md-level="3">
        <label class="md-nav__title" for="__nav_2_9_4">
          <span class="md-nav__icon md-icon"></span>
          Statusbar Fun
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/sl/status_bar_fun/2021.05.23_dwm_status_1_a_fancy_status_bar/" class="md-nav__link">
        The Problem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/sl/status_bar_fun/2021.05.24_dwm_status_2_never_call_xsession_within_dwm/" class="md-nav__link">
        XFCE
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/sl/status_bar_fun/2021.05.24_dwm_status_3_xfce4_panel_in_dwm/" class="md-nav__link">
        XFCE Panel in DWM
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/sl/status_bar_fun/2021.05.24_dwm_status_4_adding_our_monitor/" class="md-nav__link">
        CPU Monitor
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10" data-md-state="indeterminate" type="checkbox" id="__nav_2_10" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_10">
          Vim
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Vim" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_10">
          <span class="md-nav__icon md-icon"></span>
          Vim
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/vim/vim/" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/vim/astro_vim/" class="md-nav__link">
        AstroVim
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/vim/astro_vim_null_ls_builtins/" class="md-nav__link">
        AstroVimLspBuiltins
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/vim/ultisnips/" class="md-nav__link">
        Ultisnips
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/vim/html/" class="md-nav__link">
        HTML
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/todo/" class="md-nav__link">
        Todo
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" data-md-state="indeterminate" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          üí≠ CLOUD
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="üí≠ CLOUD" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          üí≠ CLOUD
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/dnsmasq/" class="md-nav__link">
        DNSMasq
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/ci/github_actions/" class="md-nav__link">
        Github Actions
      </a>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" data-md-state="indeterminate" type="checkbox" id="__nav_3_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kubernetes" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/k8s/" class="md-nav__link">
        Notes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/k8s/k9s/k9s/" class="md-nav__link">
        K9s Terminal UI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/k8s/1_hello_app/" class="md-nav__link">
        First App
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/k8s/2_hello_mysql/" class="md-nav__link">
        With DB
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" data-md-state="indeterminate" type="checkbox" id="__nav_3_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Terraform
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Terraform" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Terraform
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/terraform/" class="md-nav__link">
        About
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/terraform/resource_creation/" class="md-nav__link">
        Basic Operation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/terraform/ansible/" class="md-nav__link">
        TF And Ansible
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/terraform/k8s/" class="md-nav__link">
        Kubernetes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/terraform/k8s/k8s_on_do/" class="md-nav__link">
        K8s Cluster Infra
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/terraform/k8s/k8s_provider/do_k8s/" class="md-nav__link">
        Attaching Using Token Only
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cloud/terraform/k8s/k8s_provider/k8s_provider/" class="md-nav__link">
        The K8s Provider
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          üíª DEV
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="üíª DEV" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          üíª DEV
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          üêç Python
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="üêç Python" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          üêç Python
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../rx/" class="md-nav__link">
        Reactive Programming With RxPY
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_2" type="checkbox" id="__nav_4_1_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1_2">
          TermUIs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="TermUIs" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_1_2">
          <span class="md-nav__icon md-icon"></span>
          TermUIs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Prompt Toolkit
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Stream Control
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Stream Control
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#output-examples" class="md-nav__link">
    Output Examples
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intercept-control-user-input-to-subprocess" class="md-nav__link">
    Intercept / Control User Input to SubProcess
  </a>
  
    <nav class="md-nav" aria-label="Intercept / Control User Input to SubProcess">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simplified-program" class="md-nav__link">
    Simplified Program
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#osdup2" class="md-nav__link">
    os.dup2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-so-far" class="md-nav__link">
    Summary So Far
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ptyfork" class="md-nav__link">
    pty.fork
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-stdin-items" class="md-nav__link">
    Send Stdin Items
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    Solution
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1_3" data-md-state="indeterminate" type="checkbox" id="__nav_4_1_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1_3">
          Fun
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Fun" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_1_3">
          <span class="md-nav__icon md-icon"></span>
          Fun
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/fun/unblockme/" class="md-nav__link">
        UnblockMe
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/fun/einstein/" class="md-nav__link">
        Einstein
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" data-md-state="indeterminate" type="checkbox" id="__nav_4_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Electronics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Electronics" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Electronics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/electronics/" class="md-nav__link">
        Interacting with Real World
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2_2" data-md-state="indeterminate" type="checkbox" id="__nav_4_2_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2_2">
          Desk Cycling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Desk Cycling" data-md-level="3">
        <label class="md-nav__title" for="__nav_4_2_2">
          <span class="md-nav__icon md-icon"></span>
          Desk Cycling
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/electronics/deskcycle/intro/" class="md-nav__link">
        Zwiftifying My DeskCycle
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/electronics/deskcycle/powermeter/" class="md-nav__link">
        Power Meters
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/electronics/deskcycle/mechanical/" class="md-nav__link">
        Know the Gear Position
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/electronics/deskcycle/electromagnet/" class="md-nav__link">
        Electromagent
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ll/electronics/deskcycle/generator/" class="md-nav__link">
        Generating Power
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../inet/videos/" class="md-nav__link">
        üì∫ VIDS
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../logbook/" class="md-nav__link">
        ‚úèÔ∏è  LOG
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" data-md-state="indeterminate" type="checkbox" id="__nav_7" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../about/navigation/" class="md-nav__link">
        Navigation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#output-examples" class="md-nav__link">
    Output Examples
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#intercept-control-user-input-to-subprocess" class="md-nav__link">
    Intercept / Control User Input to SubProcess
  </a>
  
    <nav class="md-nav" aria-label="Intercept / Control User Input to SubProcess">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simplified-program" class="md-nav__link">
    Simplified Program
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#osdup2" class="md-nav__link">
    os.dup2
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#summary-so-far" class="md-nav__link">
    Summary So Far
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ptyfork" class="md-nav__link">
    pty.fork
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#send-stdin-items" class="md-nav__link">
    Send Stdin Items
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solution" class="md-nav__link">
    Solution
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="editor:///home/gk/repos/blog/docs/programming/python/prompt_toolkit/dup2.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<style>

          @media only screen and (min-width: 76.25em) {
            .md-main__inner {
              max-width: none;
            }
            .md-sidebar--primary {
              left: 0;
            }
            .md-sidebar--secondary {
              right: 0;
              margin-left: 0;
              -webkit-transform: none;
              transform: none;   
            }
          }

</style>
<h1 id="pythons-dup2-method-intercepting-stdin">Python's dup2 Method / Intercepting StdIn<a class="headerlink" href="#pythons-dup2-method-intercepting-stdin" title="Permanent link">¬§</a></h1>
<p>[2022-04-27 06:27]  </p>
<p>That time of the year, where I want to do "simple" terminal stdin redirection/duplication and
realize I forgot everything I knew about it. Lets write it down this time.</p>
<h2 id="output-examples">Output Examples<a class="headerlink" href="#output-examples" title="Permanent link">¬§</a></h2>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><input id="__tabbed_1_3" name="__tabbed_1" type="radio" /><input id="__tabbed_1_4" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Tee - By Overloading <code>stdout.write</code></label><label for="__tabbed_1_2">Simple <code>os.dup2</code> Output Example</label><label for="__tabbed_1_3">Non Blocking Subproc Stdout Reads (no threads)</label><label for="__tabbed_1_4">Same for fzf (fast)</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="o">~/</span><span class="n">gk1</span> <span class="n">master</span> <span class="err">?</span><span class="mi">7</span> <span class="err">‚ùØ</span> <span class="n">cat</span> <span class="n">tee</span><span class="o">.</span><span class="n">py</span><span class="p">;</span> <span class="n">echo</span> <span class="s1">&#39;output:&#39;</span><span class="p">;</span> <span class="n">python</span> <span class="n">tee</span><span class="o">.</span><span class="n">py</span><span class="p">;</span> <span class="n">cat</span> <span class="n">log</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="k">class</span> <span class="nc">tee</span> <span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_fd1</span><span class="p">,</span> <span class="n">_fd2</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fd1</span> <span class="o">=</span> <span class="n">_fd1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fd2</span> <span class="o">=</span> <span class="n">_fd2</span>

    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd1</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd1</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fd1</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd2</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd2</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fd2</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fd1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fd2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">flush</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fd1</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fd2</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

<span class="n">stdoutsav</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
<span class="n">outputlog</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">tee</span><span class="p">(</span><span class="n">stdoutsav</span><span class="p">,</span> <span class="n">outputlog</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>

<span class="n">output</span><span class="p">:</span>
<span class="n">foo</span>
<span class="n">foo</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;hi&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">fdopen</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">))</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<ul>
<li>Both stdout and stderr need to be streamed.</li>
<li>Both of them need to be non-blocking: when there is no output and when there are too much output.</li>
<li>Do not want to use Threading or multiprocessing, also not willing to use pexpect.</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">subprocess</span> <span class="k">as</span> <span class="nn">sbp</span>
<span class="kn">import</span> <span class="nn">fcntl</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="k">def</span> <span class="nf">non_block_read</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
    <span class="n">fl</span> <span class="o">=</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_GETFL</span><span class="p">)</span>
    <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_SETFL</span><span class="p">,</span> <span class="n">fl</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_NONBLOCK</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;</span>

<span class="k">with</span> <span class="n">sbp</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="s1">&#39;find / -name foo&#39;</span><span class="p">,</span>
                <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">universal_newlines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">,</span>
                <span class="n">bufsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">stdout</span><span class="o">=</span><span class="n">sbp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                <span class="n">stderr</span><span class="o">=</span><span class="n">sbp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">non_block_read</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">non_block_read</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;E: &#39;</span> <span class="o">+</span> <span class="n">err</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">break</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<p>The newlines are fubared in fzf, this works perfect and fast:</p>
<p>No delay noticable in fzf. nice:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">subprocess</span> <span class="k">as</span> <span class="nn">sbp</span>
<span class="kn">import</span> <span class="nn">fcntl</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="k">def</span> <span class="nf">non_block_read</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">fileno</span><span class="p">()</span>
    <span class="n">fl</span> <span class="o">=</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_GETFL</span><span class="p">)</span>
    <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_SETFL</span><span class="p">,</span> <span class="n">fl</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_NONBLOCK</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span>


<span class="k">with</span> <span class="n">sbp</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span>
    <span class="s1">&#39;fzf&#39;</span><span class="p">,</span>
    <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="c1"># universal_newlines=True,</span>
    <span class="c1"># encoding=&#39;utf-8&#39;,</span>
    <span class="c1"># bufsize=1,</span>
    <span class="n">stdout</span><span class="o">=</span><span class="n">sbp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
    <span class="n">stderr</span><span class="o">=</span><span class="n">sbp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">non_block_read</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
        <span class="n">err</span> <span class="o">=</span> <span class="n">non_block_read</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
            <span class="c1"># print(err.decode(&#39;utf-8&#39;))  # , end=&#39;&#39;)</span>
        <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">poll</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">break</span>
</code></pre></div>
</div>
</div>
</div>
<p>The inner process can detect it is not writing to a tty (try it out by calling python in a subproc
and print <code>sys.stdout.isatty()</code>. But fzf does not care - for stdout and err, behaves normally.</p>
<h2 id="intercept-control-user-input-to-subprocess">Intercept / Control User Input to SubProcess<a class="headerlink" href="#intercept-control-user-input-to-subprocess" title="Permanent link">¬§</a></h2>
<p>Big question: How to send user input from outside the process into e.g. fzf, i.e. control it.</p>
<p>Up to now we came to the conclusion that doing it from a terminal stream hijacker is the best way:
See <a href="https://github.com/axiros/termcontrol">termcontrol</a></p>
<p>But can we do it from within python?</p>
<p>I start fzf w/o piping sth into it,  pid is 3124845: </p>
<p>Via proc file system? First guess, naa, the fds there are api but not the pty itself.</p>
<p>Writing into those does only produce <em>the illusion</em> that the user typed sth:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/proc/3124845/fd/0&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span> <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span><span class="n">fd</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</code></pre></div>
<p><img alt="" src="../img/fzf2.png" /></p>
<p>fzf does not see it - E.g. after we really typed an "a" on the keyboard:</p>
<p><img alt="" src="../img/fzf3.png" /></p>
<p>All open fds: <code>lsof -P -n -p &lt;pid&gt;</code></p>
<div class="highlight"><pre><span></span><code>~/.config/ptpython ‚ùØ lsof -P -n -p 3140976
COMMAND     PID USER   FD      TYPE DEVICE SIZE/OFF     NODE NAME
fzf     3140976   gk  cwd       DIR   0,41       54 18761005 /home/gk/.config/ptpython
fzf     3140976   gk  rtd       DIR   0,35      160      256 /
fzf     3140976   gk  txt       REG   0,35  3234120  1629801 /usr/bin/fzf
fzf     3140976   gk  mem       REG   0,33           1629801 /usr/bin/fzf (path dev=0,35)
fzf     3140976   gk  mem       REG   0,33           1411886 /usr/lib64/ld-2.33.so (path dev=0,35)
fzf     3140976   gk    0u      CHR  136,7      0t0       10 /dev/pts/7
fzf     3140976   gk    1u      CHR  136,7      0t0       10 /dev/pts/7
fzf     3140976   gk    2u      CHR  136,7      0t0       10 /dev/pts/7
fzf     3140976   gk    3r      CHR    5,0      0t0       11 /dev/tty
fzf     3140976   gk    4u  a_inode   0,14        0    11950 [eventpoll:3,5]
fzf     3140976   gk    5r     FIFO   0,13      0t0 31532188 pipe
fzf     3140976   gk    6w     FIFO   0,13      0t0 31532188 pipe
</code></pre></div>
<p>The r/w FIFO at the end is interesting - is FZF maybe internally setting those up to be able to read
data here <em>and</em> user input there?</p>
<p>Is it in the filesystem?</p>
<p>Answer - nope. A python program where I open a FIFO on a file reports</p>
<p><code>python  3154696   gk    3r  FIFO   0,41      0t0 18768718 /home/gk/myfifo</code></p>
<p>I.e. I get the filename. <code>pipe</code> - that is the shell pipe which FZF built, using <code>$FZF_DEFAULT_COMMAND</code> - not for user input.</p>
<p>Also a grep for fifo on fzf source code says nothing about setting such a fifo up - except in tmux
mode and for some zshell completion.</p>
<h3 id="simplified-program">Simplified Program<a class="headerlink" href="#simplified-program" title="Permanent link">¬§</a></h3>
<p>Since we do not know what fzf <em>really</em> does internally let's start with a simple python program.</p>
<div class="highlight"><pre><span></span><code><span class="n">i</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;q&gt; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;have it&#39;</span><span class="p">)</span>
</code></pre></div>
<p>lsof reports</p>
<div class="highlight"><pre><span></span><code>python  3160241   gk    0u   CHR 136,11      0t0      14 /dev/pts/11
python  3160241   gk    1u   CHR 136,11      0t0      14 /dev/pts/11
python  3160241   gk    2u   CHR 136,11      0t0      14 /dev/pts/11
</code></pre></div>
<p>Again the naiv tries just result in stuff getting echoed but the 'have it' never shows up:</p>
<p>From another term I tried:</p>
<div class="highlight"><pre><span></span><code>echo -e &#39;foo\n&#39; &gt;&gt; /dev/pts/11
echo -e &#39;foo\x0a\x0c&#39; &gt;&gt; /dev/pts/11
cat /dev/stdin &gt;/dev/pts/11
cat - &gt; /dev/pts/11
</code></pre></div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>There is only one stdin fd and it is owned by the python process itself.</p>
</div>
<h3 id="osdup2"><code>os.dup2</code><a class="headerlink" href="#osdup2" title="Permanent link">¬§</a></h3>
<pre><code>DESCRIPTION         top
   The dup() system call allocates a new file descriptor that refers
   to the same open file description as the descriptor oldfd.  (For
   an explanation of open file descriptions, see open(2).)  The new
   file descriptor number is guaranteed to be the lowest-numbered
   file descriptor that was unused in the calling process.

   After a successful return, the old and new file descriptors may
   be used interchangeably.  Since the two file descriptors refer to
   the same open file description, they share file offset and file
   status flags; for example, if the file offset is modified by
   using lseek(2) on one of the file descriptors, the offset is also
   changed for the other file descriptor.

   The two file descriptors do not share file descriptor flags (the
   close-on-exec flag).  The close-on-exec flag (FD_CLOEXEC; see
   fcntl(2)) for the duplicate descriptor is off.

dup2()
   The dup2() system call performs the same task as dup(), but
   instead of using the lowest-numbered unused file descriptor, it
   uses the file descriptor number specified in newfd.  In other
   words, the file descriptor newfd is adjusted so that it now
   refers to the same open file description as oldfd.

   If the file descriptor newfd was previously open, it is closed
   before being reused; the close is performed silently (i.e., any
   errors during the close are not reported by dup2()).

   The steps of closing and reusing the file descriptor newfd are
   performed atomically.  This is important, because trying to
   implement equivalent functionality using close(2) and dup() would
   be subject to race conditions, whereby newfd might be reused
   between the two steps.  Such reuse could happen because the main
   program is interrupted by a signal handler that allocates a file
   descriptor, or because a parallel thread allocates a file
   descriptor.

   Note the following points:

   *  If oldfd is not a valid file descriptor, then the call fails,
      and newfd is not closed.

   *  If oldfd is a valid file descriptor, and newfd has the same
      value as oldfd, then dup2() does nothing, and returns newfd.e
</code></pre>
<blockquote>
<p>os.dup2() method in Python is used to duplicate a file descriptor fd to a given value fd2. The
file descriptor will be duplicated to fd2 only if fd2 is available and duplicated file descriptor
is inheritable by default.</p>
</blockquote>
<p>With 'inheritable':</p>
<blockquote>
<p>A Boolean value, True or False. The default value of this parameter is True, which means
duplicated file descriptor is inheritable by child processes. To make it non-inheritable set it to
False.</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="o">~</span> <span class="err">‚ùØ</span> <span class="n">cat</span> <span class="n">aa</span><span class="o">.</span><span class="n">py</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">fn</span> <span class="o">=</span> <span class="s1">&#39;myfifo&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
<span class="n">os</span><span class="o">.</span><span class="n">mkfifo</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">i</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;q&gt; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;have it:&#39;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
</code></pre></div>
<p>With this we can 'fake' user input from outside the process:</p>
<div class="highlight"><pre><span></span><code>~ ‚ùØ python aa.py &amp;
[1] 3164080
~ ‚ùØ echo answer &gt; myfifo                                                                             ÔÄì
q&gt; %
have it: answer
[1]  + 3164080 done       python aa.py
</code></pre></div>
<p>Nice.</p>
<p>Nonblocking: <code>fd = os.open(fn, os.O_RDONLY | os.O_NONBLOCK)</code> - but that breaks the input method.</p>
<p>Question: Is stdin avail also from within the process?</p>
<p>Answer: No.</p>
<p>We get terminal feedback of what we type but that's all - process now ONLY has the FIFO
for user input.</p>
<p>Because - see above:</p>
<pre><code>   If the file descriptor newfd was previously open, it is closed
   before being reused; the close is performed silently (i.e., any
   errors during the close are not reported by dup2()).
</code></pre>
<p>If we duplicate the other way round (<code>os.dup(0, fd_of_fifo)</code>) then the python process keeps having
normal stdin behaviour - but the fifo is not writeable anymore from outside. </p>
<h3 id="summary-so-far">Summary So Far<a class="headerlink" href="#summary-so-far" title="Permanent link">¬§</a></h3>
<p>What we got so far is nothing else than a straight forward input redirection:</p>
<div class="highlight"><pre><span></span><code><span class="n">os</span><span class="o">.</span><span class="n">mkfifo</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="n">fd</span>
</code></pre></div>
<p>=&gt; Where is an actual <em>duplication</em>, i.e. <code>stdin</code> available from 2 processes?</p>
<h2 id="ptyfork"><code>pty.fork</code><a class="headerlink" href="#ptyfork" title="Permanent link">¬§</a></h2>
<p>Extremely instructive:</p>
<p><a href="https://stackoverflow.com/questions/4022600/python-pty-fork-how-does-it-work">https://stackoverflow.com/questions/4022600/python-pty-fork-how-does-it-work</a></p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">pty</span>
<span class="kn">import</span> <span class="nn">subprocess</span>


<span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="n">chars</span><span class="p">):</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;    &gt; &#39;</span> <span class="o">+</span> <span class="n">chars</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

    <span class="c1"># fork this script such that a child process writes to a pty that is</span>
    <span class="c1"># controlled or &quot;spied on&quot; by the parent process</span>

    <span class="p">(</span><span class="n">child_pid</span><span class="p">,</span> <span class="n">fd</span><span class="p">)</span> <span class="o">=</span> <span class="n">pty</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>

    <span class="c1"># A new child process has been spawned and is continuing from here.</span>
    <span class="c1"># The original parent process is also continuing from here.</span>
    <span class="c1"># They have &quot;forked&quot;.</span>

    <span class="k">if</span> <span class="n">child_pid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;This is the child process fork, pid </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;Child process will run a subprocess controlled by the parent process&#39;</span><span class="p">)</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;All output, including this text, will be written to a pty and handled &#39;</span><span class="p">)</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;by the parent process.&#39;</span><span class="p">)</span>
        <span class="c1"># redirect stdout/stderr if you want to here</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s1">&#39;bash&#39;</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;This is the parent process fork, pid </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">())</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;the fd being read from, </span><span class="si">%s</span><span class="s1">, is not stdout nor stderr; it is &#39;</span> <span class="o">%</span> <span class="n">fd</span><span class="p">)</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;simply what the child is trying to write to its tty. &#39;</span><span class="p">)</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;stdout/stderr are combined along with terminal escape codes.&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">()</span>
        <span class="c1"># Read initial output of child process before &quot;typing&quot; anything in its pty</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">()</span>

        <span class="c1"># Run any bash commands you want. I/O to the fd is handled as if you are typing</span>
        <span class="c1"># at a terminal.</span>
        <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s1">&#39;ls</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s1">&#39;which git</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="c1"># you can even test tab completions</span>
        <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="s1">&#39;git sta</span><span class="se">\t\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">log</span><span class="p">(</span><span class="s1">&#39;parent will read 1024 bytes that the child wrote to its pty&#39;</span><span class="p">)</span>
            <span class="n">log</span><span class="p">(</span><span class="s1">&#39;if no new output is available, parent will wait. Exit with ctrl+c.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># take out decode() to see raw bytes the child wrote to its pty</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">fd</span><span class="p">,</span> <span class="mi">1024</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
<h2 id="send-stdin-items">Send Stdin Items<a class="headerlink" href="#send-stdin-items" title="Permanent link">¬§</a></h2>
<p>Can we control FZF?</p>
<p>With this we can send search results via a fifo:</p>
<p><code>mkfifo foo</code></p>
<p>Then start:</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">os</span>

<span class="n">s</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inheritable</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># inheritable True = default</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s1">&#39;fzf&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done&#39;</span><span class="p">)</span>
</code></pre></div>
<p>(will block waiting on open - nothing printed)</p>
<p>Then start:</p>
<div class="highlight"><pre><span></span><code><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;a</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">sdf</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">breakpoint</span><span class="p">()</span>
</code></pre></div>
<p>And you see fzf waiting for more - until you say <code>fd.close()</code> - here after the second chunk sent:</p>
<p><img alt="" src="../img/fzf1.png" /></p>
<p>(fzf progress indicator eager for more)</p>
<p>If we flushed in the sender we will see in fzf nice chunks of 1000 records. </p>
<p>Summary: We can dynamically control the data red by fzf - from a python parent process. But faking
User Input is unsolved.</p>
<h2 id="solution">Solution<a class="headerlink" href="#solution" title="Permanent link">¬§</a></h2>
<p>Here is the solution: <a href="https://github.com/asciinema/asciinema/blob/develop/asciinema/recorder.py">https://github.com/asciinema/asciinema/blob/develop/asciinema/recorder.py</a></p>
<p>They meanwhile not just simply write what is written on the pty - but really can differentiate the
source, incl. 'i' - input.</p>
<p>Nice.</p>

<script>typeof start_lc === "undefined" ? 0 : start_lc() </script>


              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        
<style>
  .md-footer__link--next {
    width: 75%;
  }
  .overlay_block {
    position: relative;
    width: 100%;
  }
  .overlay_block .overlay_link {
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    right: 0;
  }
  .overlay_block .overlay_inner {
    position: relative;
    pointer-events: none;
    z-index: 1;
  }
  .overlay_block .overlay_inner a {
    pointer-events: all;
  }
</style>

<footer class="md-footer">
  

    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Prompt Toolkit" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Prompt Toolkit
            </div>
          </div>
        </a>



       
      <div class="md-footer__link md-footer__link--next">
        
        <div class="overlay_block">
          <a
            class="overlay_link"
            href="../../../../ll/fun/unblockme/"
            rel="next"
          ></a>
          <div class="overlay_inner">
            <div class="md-footer__title">
              <div class="md-ellipsis">
                <span class="md-footer__direction">
                  Next
                </span>
                
                <a href="/blog/programming/python/rx/">
                    
                  <small>üíª DEV</small> - 
                </a>
                
                <a href="/blog/programming/python/rx/">
                    
                  <small>üêç Python</small> - 
                </a>
                
                <a href="/blog/ll/fun/unblockme/">
                    
                  <small>Fun</small> - 
                </a>
                
                <a href="/blog/ll/fun/unblockme/">
                     <span>UnblockMe</span> 
                </a>
                
              </div>
            </div>
          </div>
        </div>
        <div style="margin-left: -2rem" class="md-footer__button md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
        </div>
      </div>




      
    </nav>
  </div>
  




  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; Gunther Klessinger

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://github.com/axiros" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.instant", "navigation.top", "navigation.tabs", "navigation.sections", "navigation.expand"], "search": "../../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.6e54b5cd.min.js"></script>
      
        <script src="../../../../lcd/lp/javascript/fa_all.js"></script>
      
        <script src="../../../../lcd/lp/javascript/xterm-addon-search.min.js"></script>
      
        <script src="../../../../lcd/lp/javascript/xterm.4.9.0.min.js"></script>
      
        <script src="../../../../lcd/lp/javascript/Rx.min.js"></script>
      
        <script src="../../../../lcd/lp/javascript/tablesort.min.js"></script>
      
        <script src="../../../../lcd/lp/javascript/lc.js"></script>
      
        <script src="../../../../lcd/lp/javascript/xterm-addon-fit.min.js"></script>
      
        <script src="../../../../lcd/lp/javascript/tables.js"></script>
      
    
  </body>
</html>